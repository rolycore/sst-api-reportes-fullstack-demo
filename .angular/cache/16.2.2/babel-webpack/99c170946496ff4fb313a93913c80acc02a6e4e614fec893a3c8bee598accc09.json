{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/El Buen Pastor/Downloads/angular-11-spring-boot-jwt-authentication-master/angular-11-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { HttpEventType } from '@angular/common/http';\nimport * as saveAs from 'file-saver';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../_services/file-handler.service\";\nimport * as i2 from \"../_services/media.service\";\nimport * as i3 from \"@angular/platform-browser\";\nimport * as i4 from \"@angular/common\";\nfunction ManejoarchivosComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r0.fileStatus.requestType, \" \", ctx_r0.fileStatus.percent, \"% completado\");\n  }\n}\nfunction ManejoarchivosComponent_li_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\", 13);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const filename_r4 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(filename_r4);\n  }\n}\nfunction ManejoarchivosComponent_div_20_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function ManejoarchivosComponent_div_20_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.clearImage());\n    });\n    i0.ɵɵtext(2, \"Clear\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"img\", 15);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"src\", ctx_r2.previsualizacion, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction ManejoarchivosComponent_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function ManejoarchivosComponent_div_24_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.subirArchivo());\n    });\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r3.loading);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.loading ? \"Cargando.....\" : \"Subir Archivo\", \" \");\n  }\n}\nexport let ManejoarchivosComponent = /*#__PURE__*/(() => {\n  var _class;\n  class ManejoarchivosComponent {\n    constructor(fileHandlerService, mediaservice, sanitizer) {\n      var _this = this;\n      this.fileHandlerService = fileHandlerService;\n      this.mediaservice = mediaservice;\n      this.sanitizer = sanitizer;\n      this.titulo = 'Archivos';\n      this.archivos = [];\n      // Especifica el tipo de datos para selectedFiles como un array de File\n      this.selectedFiles = [];\n      this.filenames = [];\n      this.files = [];\n      this.fileStatus = {\n        status: \"\",\n        requestType: \"\",\n        percent: 0\n      };\n      this.extraerBase64 = /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* ($event) {\n          try {\n            const unsafeImg = window.URL.createObjectURL($event);\n            const image = _this.sanitizer.bypassSecurityTrustUrl(unsafeImg);\n            const reader = new FileReader();\n            return new Promise((resolve, reject) => {\n              reader.readAsDataURL($event);\n              reader.onload = () => {\n                resolve({\n                  base: reader.result\n                });\n              };\n              reader.onerror = error => {\n                resolve({\n                  base: null\n                });\n              };\n            });\n          } catch (e) {\n            return {\n              base: null\n            };\n          }\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }();\n    }\n    ngOnInit() {}\n    onFileSelected(event) {\n      const inputElement = event.target;\n      if (inputElement && inputElement.files && inputElement.files.length > 0) {\n        // Limpiamos la lista de archivos seleccionados y la llenamos con los nuevos archivos\n        this.selectedFiles = [];\n        for (let i = 0; i < inputElement.files.length; i++) {\n          this.selectedFiles.push(inputElement.files[i]);\n        }\n      }\n    }\n    onUploadFiles(files) {\n      const formData = new FormData();\n      files.forEach(f => formData.append(\"files\", f, f.name));\n      this.fileHandlerService.upload(formData).subscribe(response => {\n        console.log(response);\n        this.reportProgress(response);\n      }, error => {\n        console.log(error.message);\n        alert(error.message);\n      });\n    }\n    reportProgress(httpEvent) {\n      switch (httpEvent.type) {\n        case HttpEventType.UploadProgress:\n          this.updateStatus(httpEvent.loaded, httpEvent.total, \"Uploading...\");\n          break;\n        case HttpEventType.DownloadProgress:\n          this.updateStatus(httpEvent.loaded, httpEvent.total, \"Downloading...\");\n          break;\n        case HttpEventType.ResponseHeader:\n          console.log(\"header returned...\", httpEvent);\n          break;\n        case HttpEventType.Response:\n          if (httpEvent.body instanceof Array) {\n            httpEvent.body.forEach(filename => this.filenames.unshift(filename));\n          } else {\n            saveAs(new File([httpEvent.body], httpEvent.headers.get('File-Name'), {\n              type: httpEvent.headers.get('Content-Type') + \";charset=utf-8\"\n            }));\n          }\n          break;\n        default:\n          console.log(httpEvent);\n      }\n    }\n    updateStatus(loaded, total, requestType) {\n      this.finish = false;\n      this.fileStatus.status = \"progress\";\n      this.fileStatus.requestType = requestType;\n      this.fileStatus.percent = Math.round(100 * loaded / total);\n      if (this.fileStatus.percent = 100) {\n        this.fileStatus.status = \"\";\n        this.fileStatus.requestType = \"\";\n        this.fileStatus.percent = 0;\n      }\n    }\n    onDownloadFiles(filename) {\n      this.fileHandlerService.download(filename).subscribe(response => {\n        console.log(response);\n        this.reportProgress(response);\n      }, error => {\n        console.log(error.message);\n        alert(error.message);\n      });\n    }\n    capturarFile(event) {\n      const archivoCapturado = event.target.files[0];\n      this.extraerBase64(archivoCapturado).then(imagen => {\n        this.previsualizacion = imagen.base;\n        console.log(imagen);\n      });\n      this.archivos.push(archivoCapturado);\n      //\n      // console.log(event.target.files);\n    }\n    /**\n     * Limpiar imagen\n     */\n    clearImage() {\n      this.previsualizacion = '';\n      this.archivos = [];\n    }\n    subirArchivo() {\n      try {\n        this.loading = true;\n        const formularioDeDatos = new FormData();\n        this.archivos.forEach(() => {\n          formularioDeDatos.append('file', this.archivos);\n        });\n        // formularioDeDatos.append('_id', 'MY_ID_123')\n        this.mediaservice.uploadFile(formularioDeDatos).subscribe(res => {\n          this.loading = false;\n          console.log('Respuesta del servidor', res);\n        }, () => {\n          this.loading = false;\n          alert('Error');\n        });\n      } catch (e) {\n        this.loading = false;\n        console.log('ERROR', e);\n      }\n    }\n  }\n  _class = ManejoarchivosComponent;\n  _class.ɵfac = function ManejoarchivosComponent_Factory(t) {\n    return new (t || _class)(i0.ɵɵdirectiveInject(i1.FileHandlerService), i0.ɵɵdirectiveInject(i2.MediaService), i0.ɵɵdirectiveInject(i3.DomSanitizer));\n  };\n  _class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _class,\n    selectors: [[\"app-manejoarchivos\"]],\n    decls: 25,\n    vars: 5,\n    consts: [[1, \"row\"], [1, \"col-md-12\"], [1, \"card-header\"], [1, \"card-body\", \"bg-dark\", \"text-white\"], [1, \"card-title\"], [\"type\", \"file\", \"multiple\", \"\", 1, \"input-file\", 3, \"change\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [4, \"ngIf\"], [1, \"list-group\"], [\"class\", \"list-group-item\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"button\", 1, \"btn\", \"btn-success\", 3, \"click\"], [\"type\", \"file\", 1, \"input-file\", 3, \"change\"], [1, \"card-text\"], [1, \"list-group-item\"], [\"type\", \"button\", \"type\", \"button\", 1, \"btn\", \"btn-warning\", 3, \"click\"], [\"alt\", \"\", 3, \"src\"], [\"type\", \"button\", 1, \"btn\", \"btn-secondary\", 3, \"disabled\", \"click\"]],\n    template: function ManejoarchivosComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2);\n        i0.ɵɵtext(3);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 3)(5, \"h2\", 4);\n        i0.ɵɵtext(6, \"Manejo de archivos\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"input\", 5);\n        i0.ɵɵlistener(\"change\", function ManejoarchivosComponent_Template_input_change_7_listener($event) {\n          return ctx.onFileSelected($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function ManejoarchivosComponent_Template_button_click_8_listener() {\n          return ctx.onUploadFiles(ctx.selectedFiles);\n        });\n        i0.ɵɵtext(9, \"Cargar archivos\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(10, ManejoarchivosComponent_div_10_Template, 3, 2, \"div\", 7);\n        i0.ɵɵelementStart(11, \"h3\", 4);\n        i0.ɵɵtext(12, \"Archivos cargados:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"ul\", 8);\n        i0.ɵɵtemplate(14, ManejoarchivosComponent_li_14_Template, 2, 1, \"li\", 9);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"button\", 10);\n        i0.ɵɵlistener(\"click\", function ManejoarchivosComponent_Template_button_click_15_listener() {\n          return ctx.onDownloadFiles(ctx.filenameToDownload);\n        });\n        i0.ɵɵtext(16, \"Descargar archivo\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(17, \"h3\", 4);\n        i0.ɵɵtext(18, \"Subir imagen:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(19, \"input\", 11);\n        i0.ɵɵlistener(\"change\", function ManejoarchivosComponent_Template_input_change_19_listener($event) {\n          return ctx.capturarFile($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(20, ManejoarchivosComponent_div_20_Template, 4, 1, \"div\", 7);\n        i0.ɵɵelementStart(21, \"div\")(22, \"small\", 12);\n        i0.ɵɵtext(23, \"Se aceptan archivos im\\u00E1genes de tipo .png\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(24, ManejoarchivosComponent_div_24_Template, 3, 2, \"div\", 7);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.titulo);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngIf\", ctx.fileStatus.status === \"progress\");\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngForOf\", ctx.filenames);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngIf\", ctx.previsualizacion);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngIf\", ctx.previsualizacion);\n      }\n    },\n    dependencies: [i4.NgForOf, i4.NgIf]\n  });\n  return ManejoarchivosComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}